# æ—¶é—´æ—…è¡Œ â±ï¸

!!! note "å‰ææ¡ä»¶"

    æœ¬æŒ‡å—å‡è®¾æ‚¨ç†Ÿæ‚‰ LangGraph çš„æ£€æŸ¥ç‚¹å’ŒçŠ¶æ€ã€‚å¦‚æœä¸ç†Ÿæ‚‰ï¼Œè¯·å…ˆå¤ä¹ [æŒä¹…æ€§](./persistence.md)æ¦‚å¿µã€‚

åœ¨å¤„ç†åŸºäºæ¨¡å‹åšå‡ºå†³ç­–çš„éç¡®å®šæ€§ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œç”± LLM é©±åŠ¨çš„ä»£ç†ï¼‰æ—¶ï¼Œè¯¦ç»†æ£€æŸ¥å…¶å†³ç­–è¿‡ç¨‹éå¸¸æœ‰ç”¨ï¼š

1. ğŸ¤” **ç†è§£æ¨ç†**ï¼šåˆ†æå¯¼è‡´æˆåŠŸç»“æœçš„æ­¥éª¤ã€‚
2. ğŸ **è°ƒè¯•é”™è¯¯**ï¼šè¯†åˆ«é”™è¯¯å‘ç”Ÿçš„ä½ç½®å’ŒåŸå› ã€‚
3. ğŸ” **æ¢ç´¢æ›¿ä»£æ–¹æ¡ˆ**ï¼šæµ‹è¯•ä¸åŒçš„è·¯å¾„ä»¥å‘ç°æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚

æˆ‘ä»¬ç§°è¿™äº›è°ƒè¯•æŠ€æœ¯ä¸º**æ—¶é—´æ—…è¡Œ**ï¼Œç”±ä¸¤ä¸ªå…³é”®æ“ä½œç»„æˆï¼š[**é‡æ”¾**](#replaying) ğŸ” å’Œ [**åˆ†å‰**](#forking) ğŸ”€ ã€‚

## é‡æ”¾

![](./img/human_in_the_loop/replay.png)

é‡æ”¾å…è®¸æˆ‘ä»¬å›é¡¾å¹¶é‡ç°ä»£ç†è¿‡å»çš„æ“ä½œï¼Œç›´è‡³å¹¶åŒ…æ‹¬ç‰¹å®šæ­¥éª¤ï¼ˆæ£€æŸ¥ç‚¹ï¼‰ã€‚

è¦é‡æ”¾ç‰¹å®šæ£€æŸ¥ç‚¹ä¹‹å‰çš„æ“ä½œï¼Œé¦–å…ˆæ£€ç´¢è¯¥çº¿ç¨‹çš„æ‰€æœ‰æ£€æŸ¥ç‚¹ï¼š

```python
all_checkpoints = []
for state in graph.get_state_history(thread):
    all_checkpoints.append(state)
```

æ¯ä¸ªæ£€æŸ¥ç‚¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IDã€‚åœ¨ç¡®å®šæ‰€éœ€çš„æ£€æŸ¥ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`xyz`ï¼‰åï¼Œå°†å…¶ ID åŒ…å«åœ¨é…ç½®ä¸­ï¼š

```python
config = {'configurable': {'thread_id': '1', 'checkpoint_id': 'xyz'}}
for event in graph.stream(None, config, stream_mode="values"):
    print(event)
```

å›¾å½¢å°†é‡æ”¾ä¹‹å‰æ‰§è¡Œçš„æ­¥éª¤ _åœ¨_ æä¾›çš„ `checkpoint_id` ä¹‹å‰ï¼Œå¹¶æ‰§è¡Œ `checkpoint_id` _ä¹‹å_ çš„æ­¥éª¤ï¼ˆå³ä¸€ä¸ªæ–°çš„åˆ†å‰ï¼‰ï¼Œå³ä½¿å®ƒä»¬ä¹‹å‰å·²ç»æ‰§è¡Œè¿‡ã€‚

## åˆ†å‰

![](./img/human_in_the_loop/forking.png)

åˆ†å‰å…è®¸æ‚¨å›é¡¾ä»£ç†è¿‡å»çš„æ“ä½œï¼Œå¹¶åœ¨å›¾å½¢ä¸­æ¢ç´¢æ›¿ä»£è·¯å¾„ã€‚

è¦ç¼–è¾‘ç‰¹å®šæ£€æŸ¥ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ`xyz`ï¼‰ï¼Œåœ¨æ›´æ–°å›¾å½¢çŠ¶æ€æ—¶æä¾›å…¶ `checkpoint_id`ï¼š

```python
config = {"configurable": {"thread_id": "1", "checkpoint_id": "xyz"}}
graph.update_state(config, {"state": "updated state"})
```

è¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†å‰æ£€æŸ¥ç‚¹ `xyz-fork`ï¼Œæ‚¨å¯ä»¥ä»ä¸­ç»§ç»­è¿è¡Œå›¾å½¢ï¼š

```python
config = {'configurable': {'thread_id': '1', 'checkpoint_id': 'xyz-fork'}}
for event in graph.stream(None, config, stream_mode="values"):
    print(event)
```

## é™„åŠ èµ„æº ğŸ“š

- [**æ¦‚å¿µæŒ‡å—ï¼šæŒä¹…æ€§**](https://langchain-ai.github.io/langgraph/concepts/persistence/#replay)ï¼šé˜…è¯»æŒä¹…æ€§æŒ‡å—ä»¥è·å–æ›´å¤šå…³äºé‡æ”¾çš„èƒŒæ™¯ä¿¡æ¯ã€‚
- [**å¦‚ä½•æŸ¥çœ‹å’Œæ›´æ–°è¿‡å»çš„å›¾å½¢çŠ¶æ€**](../how-tos/human_in_the_loop/time-travel.ipynb)ï¼šé€æ­¥æŒ‡å¯¼å¦‚ä½•æ“ä½œå›¾å½¢çŠ¶æ€ï¼Œå±•ç¤º**é‡æ”¾**å’Œ**åˆ†å‰**æ“ä½œã€‚