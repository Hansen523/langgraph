# è®¾ç½®è‡ªå®šä¹‰è®¤è¯ï¼ˆç¬¬1éƒ¨åˆ†/å…±3éƒ¨åˆ†ï¼‰

!!! note "è¿™æ˜¯æˆ‘ä»¬çš„è®¤è¯ç³»åˆ—çš„ç¬¬1éƒ¨åˆ†ï¼š"

    1. åŸºç¡€è®¤è¯ï¼ˆä½ åœ¨è¿™é‡Œï¼‰- æ§åˆ¶è°å¯ä»¥è®¿é—®ä½ çš„æœºå™¨äºº
    2. [èµ„æºæˆæƒ](resource_auth.md) - è®©ç”¨æˆ·æ‹¥æœ‰ç§äººå¯¹è¯
    3. [ç”Ÿäº§ç¯å¢ƒè®¤è¯](add_auth_server.md) - æ·»åŠ çœŸå®ç”¨æˆ·è´¦æˆ·å¹¶ä½¿ç”¨OAuth2è¿›è¡ŒéªŒè¯

!!! tip "å‰ææ¡ä»¶"

    æœ¬æŒ‡å—å‡è®¾ä½ å¯¹ä»¥ä¸‹æ¦‚å¿µæœ‰åŸºæœ¬äº†è§£ï¼š

      *  [**è®¤è¯ä¸è®¿é—®æ§åˆ¶**](../../concepts/auth.md)
      *  [**LangGraphå¹³å°**](../../concepts/index.md#langgraph-platform)

!!! note "ä»…é™Python"

    æˆ‘ä»¬ç›®å‰ä»…åœ¨Pythonéƒ¨ç½²ä¸­æ”¯æŒè‡ªå®šä¹‰è®¤è¯å’Œæˆæƒï¼Œè¦æ±‚`langgraph-api>=0.0.11`ã€‚å¯¹LangGraph.JSçš„æ”¯æŒå°†å¾ˆå¿«æ·»åŠ ã€‚

???+ note "æŒ‰éƒ¨ç½²ç±»å‹æ”¯æŒ"

    è‡ªå®šä¹‰è®¤è¯åœ¨**æ‰˜ç®¡LangGraphäº‘**ä¸­çš„æ‰€æœ‰éƒ¨ç½²ä»¥åŠ**ä¼ä¸š**è‡ªæ‰˜ç®¡è®¡åˆ’ä¸­éƒ½å—æ”¯æŒã€‚**Lite**è‡ªæ‰˜ç®¡è®¡åˆ’ä¸æ”¯æŒã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªåªå…è®¸ç‰¹å®šç”¨æˆ·è®¿é—®çš„èŠå¤©æœºå™¨äººã€‚æˆ‘ä»¬å°†ä»LangGraphæ¨¡æ¿å¼€å§‹ï¼Œé€æ­¥æ·»åŠ åŸºäºä»¤ç‰Œçš„å®‰å…¨æ€§ã€‚åˆ°æœ€åï¼Œä½ å°†æ‹¥æœ‰ä¸€ä¸ªåœ¨å…è®¸è®¿é—®ä¹‹å‰æ£€æŸ¥æœ‰æ•ˆä»¤ç‰Œçš„å·¥ä½œèŠå¤©æœºå™¨äººã€‚

## è®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®

é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä½¿ç”¨LangGraphå¯åŠ¨æ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„èŠå¤©æœºå™¨äººï¼š

```bash
pip install -U "langgraph-cli[inmem]"
langgraph new --template=new-langgraph-project-python custom-auth
cd custom-auth
```

è¯¥æ¨¡æ¿ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå ä½ç¬¦çš„LangGraphåº”ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬é€šè¿‡å®‰è£…æœ¬åœ°ä¾èµ–é¡¹å¹¶è¿è¡Œå¼€å‘æœåŠ¡å™¨æ¥å°è¯•å®ƒã€‚
```shell
pip install -e .
langgraph dev
```
å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼ŒæœåŠ¡å™¨åº”è¯¥å¯åŠ¨å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€Studioã€‚

> - ğŸš€ API: http://127.0.0.1:2024
> - ğŸ¨ Studio UI: https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024
> - ğŸ“š API Docs: http://127.0.0.1:2024/docs
> 
> æ­¤å†…å­˜æœåŠ¡å™¨è®¾è®¡ç”¨äºå¼€å‘å’Œæµ‹è¯•ã€‚
> ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨LangGraphäº‘ã€‚

å›¾è¡¨åº”è¯¥è¿è¡Œï¼Œå¦‚æœä½ å°†å…¶è‡ªæ‰˜ç®¡åœ¨å…¬å…±äº’è”ç½‘ä¸Šï¼Œä»»ä½•äººéƒ½å¯ä»¥è®¿é—®å®ƒï¼

![æ— è®¤è¯](./img/no_auth.png)

ç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†åŸºç¡€çš„LangGraphåº”ç”¨ç¨‹åºï¼Œè®©æˆ‘ä»¬ä¸ºå®ƒæ·»åŠ è®¤è¯ï¼

???+ tip "å ä½ç¬¦ä»¤ç‰Œ"
    
    åœ¨ç¬¬1éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä»ä¸€ä¸ªç¡¬ç¼–ç çš„ä»¤ç‰Œå¼€å§‹ï¼Œç”¨äºè¯´æ˜ç›®çš„ã€‚
    åœ¨æŒæ¡äº†åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬3éƒ¨åˆ†ä¸­å®ç°â€œç”Ÿäº§å°±ç»ªâ€çš„è®¤è¯æ–¹æ¡ˆã€‚

## æ·»åŠ è®¤è¯

[`Auth`](../../cloud/reference/sdk/python_sdk_ref.md#langgraph_sdk.auth.Auth)å¯¹è±¡å…è®¸ä½ æ³¨å†Œä¸€ä¸ªè®¤è¯å‡½æ•°ï¼ŒLangGraphå¹³å°å°†åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šè¿è¡Œè¯¥å‡½æ•°ã€‚æ­¤å‡½æ•°æ¥æ”¶æ¯ä¸ªè¯·æ±‚å¹¶å†³å®šæ˜¯å¦æ¥å—æˆ–æ‹’ç»ã€‚

åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶`src/security/auth.py`ã€‚è¿™æ˜¯æˆ‘ä»¬ç”¨æ¥æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¢«å…è®¸è®¿é—®æœºå™¨äººçš„ä»£ç ï¼š

```python hl_lines="10 15-16" title="src/security/auth.py"
from langgraph_sdk import Auth

# è¿™æ˜¯æˆ‘ä»¬çš„ç©å…·ç”¨æˆ·æ•°æ®åº“ã€‚ç”Ÿäº§ç¯å¢ƒä¸­ä¸è¦è¿™æ ·åš
VALID_TOKENS = {
    "user1-token": {"id": "user1", "name": "Alice"},
    "user2-token": {"id": "user2", "name": "Bob"},
}

# "Auth"å¯¹è±¡æ˜¯ä¸€ä¸ªå®¹å™¨ï¼ŒLangGraphå°†ä½¿ç”¨å®ƒæ¥æ ‡è®°æˆ‘ä»¬çš„è®¤è¯å‡½æ•°
auth = Auth()


# `authenticate`è£…é¥°å™¨å‘Šè¯‰LangGraphå°†æ­¤å‡½æ•°ä½œä¸ºä¸­é—´ä»¶è°ƒç”¨
# ç”¨äºæ¯ä¸ªè¯·æ±‚ã€‚è¿™å°†å†³å®šæ˜¯å¦å…è®¸è¯·æ±‚
@auth.authenticate
async def get_current_user(authorization: str | None) -> Auth.types.MinimalUserDict:
    """æ£€æŸ¥ç”¨æˆ·çš„ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆã€‚"""
    assert authorization
    scheme, token = authorization.split()
    assert scheme.lower() == "bearer"
    # æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
    if token not in VALID_TOKENS:
        raise Auth.exceptions.HTTPException(status_code=401, detail="æ— æ•ˆä»¤ç‰Œ")

    # å¦‚æœæœ‰æ•ˆï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯
    user_data = VALID_TOKENS[token]
    return {
        "identity": user_data["id"],
    }
```

æ³¨æ„ï¼Œæˆ‘ä»¬çš„[è®¤è¯](../../cloud/reference/sdk/python_sdk_ref.md#langgraph_sdk.auth.Auth.authenticate)å¤„ç†ç¨‹åºåšäº†ä¸¤ä»¶é‡è¦çš„äº‹æƒ…ï¼š

1. æ£€æŸ¥è¯·æ±‚çš„[Authorizationå¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Authorization)ä¸­æ˜¯å¦æä¾›äº†æœ‰æ•ˆä»¤ç‰Œ
2. è¿”å›ç”¨æˆ·çš„[èº«ä»½](../../cloud/reference/sdk/python_sdk_ref.md#langgraph_sdk.auth.types.MinimalUserDict)

ç°åœ¨ï¼Œé€šè¿‡å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°[`langgraph.json`](../../cloud/reference/cli.md#configuration-file)é…ç½®ä¸­ï¼Œå‘Šè¯‰LangGraphä½¿ç”¨æˆ‘ä»¬çš„è®¤è¯ï¼š

```json hl_lines="7-9" title="langgraph.json"
{
  "dependencies": ["."],
  "graphs": {
    "agent": "./src/agent/graph.py:graph"
  },
  "env": ".env",
  "auth": {
    "path": "src/security/auth.py:auth"
  }
}
```

## æµ‹è¯•æˆ‘ä»¬çš„â€œå®‰å…¨â€æœºå™¨äºº

è®©æˆ‘ä»¬å†æ¬¡å¯åŠ¨æœåŠ¡å™¨æ¥æµ‹è¯•ä¸€åˆ‡ï¼

```bash
langgraph dev --no-browser
```

??? note "Studioä¸­çš„è‡ªå®šä¹‰è®¤è¯"

    å¦‚æœä½ æ²¡æœ‰æ·»åŠ `--no-browser`ï¼ŒStudio UIå°†åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚ä½ å¯èƒ½ä¼šæƒ³ï¼ŒStudioå¦‚ä½•ä»ç„¶èƒ½å¤Ÿè¿æ¥åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œå³ä½¿ä½¿ç”¨è‡ªå®šä¹‰è®¤è¯ï¼Œæˆ‘ä»¬ä¹Ÿå…è®¸ä»LangGraph Studioè®¿é—®ã€‚è¿™ä½¿å¾—åœ¨Studioä¸­å¼€å‘å’Œæµ‹è¯•ä½ çš„æœºå™¨äººæ›´åŠ å®¹æ˜“ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ä½ çš„è®¤è¯é…ç½®ä¸­è®¾ç½®`disable_studio_auth: "true"`æ¥åˆ é™¤æ­¤æ›¿ä»£è®¤è¯é€‰é¡¹ï¼š
    ```json
    {
        "auth": {
            "path": "src/security/auth.py:auth",
            "disable_studio_auth": "true"
        }
    }
    ```

ç°åœ¨è®©æˆ‘ä»¬å°è¯•ä¸æˆ‘ä»¬çš„æœºå™¨äººèŠå¤©ã€‚å¦‚æœæˆ‘ä»¬æ­£ç¡®å®ç°äº†è®¤è¯ï¼Œæˆ‘ä»¬åº”è¯¥åªæœ‰åœ¨è¯·æ±‚å¤´ä¸­æä¾›æœ‰æ•ˆä»¤ç‰Œæ—¶æ‰èƒ½è®¿é—®æœºå™¨äººã€‚ç„¶è€Œï¼Œåœ¨æˆ‘ä»¬æ·»åŠ [èµ„æºæˆæƒå¤„ç†ç¨‹åº](../../concepts/auth.md#resource-authorization)ä¹‹å‰ï¼Œç”¨æˆ·ä»ç„¶å¯ä»¥è®¿é—®å½¼æ­¤çš„èµ„æºã€‚

![è®¤è¯ï¼Œæ— æˆæƒå¤„ç†ç¨‹åº](./img/authentication.png)

åœ¨æ–‡ä»¶æˆ–ç¬”è®°æœ¬ä¸­è¿è¡Œä»¥ä¸‹ä»£ç ï¼š

```python
from langgraph_sdk import get_client

# å°è¯•ä¸ä½¿ç”¨ä»¤ç‰Œï¼ˆåº”è¯¥å¤±è´¥ï¼‰
client = get_client(url="http://localhost:2024")
try:
    thread = await client.threads.create()
    print("âŒ æ²¡æœ‰ä»¤ç‰Œæ—¶åº”è¯¥å¤±è´¥ï¼")
except Exception as e:
    print("âœ… æ­£ç¡®é˜»æ­¢è®¿é—®:", e)

# å°è¯•ä½¿ç”¨æœ‰æ•ˆä»¤ç‰Œ
client = get_client(
    url="http://localhost:2024", headers={"Authorization": "Bearer user1-token"}
)

# åˆ›å»ºçº¿ç¨‹å¹¶èŠå¤©
thread = await client.threads.create()
print(f"âœ… ä»¥Aliceèº«ä»½åˆ›å»ºçº¿ç¨‹: {thread['thread_id']}")

response = await client.runs.create(
    thread_id=thread["thread_id"],
    assistant_id="agent",
    input={"messages": [{"role": "user", "content": "Hello!"}]},
)
print("âœ… æœºå™¨äººå“åº”:")
print(response)
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š

1. æ²¡æœ‰æœ‰æ•ˆä»¤ç‰Œæ—¶ï¼Œæˆ‘ä»¬æ— æ³•è®¿é—®æœºå™¨äºº
2. ä½¿ç”¨æœ‰æ•ˆä»¤ç‰Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºçº¿ç¨‹å¹¶èŠå¤©

æ­å–œï¼ä½ å·²ç»æ„å»ºäº†ä¸€ä¸ªåªå…è®¸â€œè®¤è¯â€ç”¨æˆ·è®¿é—®çš„èŠå¤©æœºå™¨äººã€‚è™½ç„¶è¿™ä¸ªç³»ç»Ÿï¼ˆå°šæœªï¼‰å®ç°ç”Ÿäº§å°±ç»ªçš„å®‰å…¨æ–¹æ¡ˆï¼Œä½†æˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•æ§åˆ¶è®¿é—®æˆ‘ä»¬æœºå™¨äººçš„åŸºæœ¬æœºåˆ¶ã€‚åœ¨ä¸‹ä¸€ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä¸ºæ¯ä¸ªç”¨æˆ·æä¾›ä»–ä»¬è‡ªå·±çš„ç§äººå¯¹è¯ã€‚

## ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ

ç°åœ¨ä½ å¯ä»¥æ§åˆ¶è°å¯ä»¥è®¿é—®ä½ çš„æœºå™¨äººï¼Œä½ å¯èƒ½æƒ³ï¼š

1. ç»§ç»­æ•™ç¨‹ï¼Œå‰å¾€[ä½¿å¯¹è¯ç§æœ‰åŒ–ï¼ˆç¬¬2éƒ¨åˆ†/å…±3éƒ¨åˆ†ï¼‰](resource_auth.md)å­¦ä¹ èµ„æºæˆæƒã€‚
2. é˜…è¯»æ›´å¤šå…³äº[è®¤è¯æ¦‚å¿µ](../../concepts/auth.md)çš„å†…å®¹ã€‚
3. æŸ¥çœ‹[APIå‚è€ƒ](../../cloud/reference/sdk/python_sdk_ref.md)ä»¥è·å–æ›´å¤šè®¤è¯ç»†èŠ‚ã€‚